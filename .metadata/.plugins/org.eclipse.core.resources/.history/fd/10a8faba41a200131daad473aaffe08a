package Bucket;
import java.io.File;
import java.io.IOException;

import com.amazonaws.auth.ClasspathPropertiesFileCredentialsProvider;
import com.amazonaws.regions.Region;
import com.amazonaws.regions.Regions;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3Client;
import com.amazonaws.services.s3.model.CannedAccessControlList;
import com.amazonaws.services.s3.model.CreateBucketRequest;
import com.amazonaws.services.s3.model.ListObjectsRequest;
import com.amazonaws.services.s3.model.ObjectListing;
import com.amazonaws.services.s3.model.PutObjectRequest;
import com.amazonaws.services.s3.model.S3ObjectSummary;
public class S3BucketManager {
	 public static void main(String[] args) throws IOException {
	        /*
	         * This credentials provider implementation loads your AWS credentials
	         * from a properties file at the root of your classpath.
	         *
	         * Important: Be sure to fill in your AWS access credentials in the
	         *            AwsCredentials.properties file before you try to run this
	         *            sample.
	         * http://aws.amazon.com/security-credentials
	         */
	        AmazonS3 s3 = new AmazonS3Client(new ClasspathPropertiesFileCredentialsProvider());
			Region usWest2 = Region.getRegion(Regions.US_WEST_2);
			s3.setRegion(usWest2);

	        String bucketName = "liguifan3432";
	        //+ UUID.randomUUID();
	        String key = "Movie";

	        System.out.println("===========================================");
	        System.out.println("Getting Started with Amazon S3");
	        System.out.println("===========================================\n");
	
	
	public void putObject(String key, File file)
	{		
		try {
			//put object - bucket, key, value(file)
			System.out.println("Putting object on S3");
			s3.putObject(new PutObjectRequest(bucket_name, key, file).withCannedAcl(CannedAccessControlList.PublicRead));
			System.out.println("Done");
		} catch (Exception e) {
			e.printStackTrace();
		}
	}
	
	public static void create_bucket(String bucketName, String key){
		AmazonS3 s3 = new AmazonS3Client(new ClasspathPropertiesFileCredentialsProvider());
		Region usWest2 = Region.getRegion(Regions.US_WEST_2);
		s3.setRegion(usWest2);
//		String bucketName = "liguifan3431";
//		String key = "Movie";
		System.out.println("Creating bucket " + bucketName + "\n");
		s3.createBucket(bucketName);
		System.out.println("Listing buckets");
		System.out.println();
	}

	
	// path="/Users/liguifan/Desktop/music/IMG_0155.MOV"
	public static String upload(String path, String bucketName, String key_temp, AmazonS3 s3){
		String key = "\""+key_temp+"\"";
		String key2 =key+"\"";
		
		System.out.println("Uploading a new object to S3 with name"+key+"\n");
		s3.putObject(new PutObjectRequest(bucketName, key, new File(path))
				.withCannedAcl(CannedAccessControlList.PublicRead));

		System.out.println("Listing objects");
		ObjectListing objectListing = s3.listObjects(new ListObjectsRequest()
		.withBucketName(bucketName)
		.withPrefix("My"));
		for (S3ObjectSummary objectSummary : objectListing.getObjectSummaries()) {
			System.out.println(" - " + objectSummary.getKey() + "  " +
					"(size = " + objectSummary.getSize() + ")");
		}
		System.out.println();
		String url_link="\"https://s3-us-west-2.amazonaws.com"+"/"+bucketName+"/"+key2;
		return "insert into video_info values("+key+","+url_link+")";
	}
}
